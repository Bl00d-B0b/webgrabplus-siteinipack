**------------------------------------------------------------------------------------------------
* @header_start
* WebGrab+Plus ini for grabbing EPG data from TvGuide websites
* @Site: vivacom.bg
* @MinSWversion: V3.1
* @Revision 4 - [26/01/2021] Blackbear199
*	- rewrite
* @Revision 3 - [11/11/2016] Blackbear199
*	- url_index change
* @Revision 2 - [19/12/2014] Francis De Paemeleere
*	- new index page
* @Revision 1 - [03/06/2014] Jan van Straaten
*	- completely new
* @Revision 0 - [13/02/2014] Francis De Paemeleere
*   - creation
* @Remarks:
* @header_end
**------------------------------------------------------------------------------------------------
site {url=vivacom.bg|timezone=Europe/Sofia|maxdays=7|cultureinfo=bg-BG|charset=UTF-8|titlematchfactor=90|keepindexpage}
site {ratingsystem=BG|episodesystem=onscreen}
*
url_index {url|https://www.vivacom.bg/bg/tv/programa/?date=|urldate|&page=|subpage|}
url_index.headers {customheader=Accept-Encoding=gzip,deflate}

urldate.format {datestring|yyyy-MM-dd}
subpage.format {list(format=D0 step=1 count=30)|1}
*
index_variable_element.modify {set|'config_site_id'}
index_urlchannellogo.scrub {single|<li title="'index_variable_element'">|<img src="|"|</li>}
index_urlchannellogo.modify {addstart(not "")|https://www.vivacom.bg}
*
index_showsplit.scrub {multi|<div class="schedule">||<div class="line line-bottom">|<div class="line line-bottom">} * the channel list & programs for each page
scope.range {(splitindex)|end}
loop {(each "index_temp_9" in 'index_showsplit')|end}
index_temp_2.modify {clear}
index_temp_3.modify {clear}
index_temp_4.modify {clear}
index_temp_1.modify {substring(type=regex)|'index_temp_9' "<ol id=\"scroll-vertical\">(?:.*?)(?:<li title=\"([^\"]*)\">(?:.*?))*<\/ol>"} * channels
index_temp_2.modify {substring(type=regex)|'index_temp_9' "<div id=\"scroll-horizontal\">(?:.*?)(?:<ul>(.*?)<\/ul>(?:.*?))*<\/div>"} * program blocks
index_temp_3.modify {calculate(format=D0 type=element)|'index_temp_1' 'index_variable_element' @} * index of selected channel
*index_temp_3.modify {clear("-1")}
index_temp_4.modify {substring('index_temp_3' not "-1" type=element)|'index_temp_2' 'index_temp_3' 1}
index_temp_5.modify {addend('index_temp_4' not "")|'index_temp_4'}
end_loop
index_showsplit.modify {substring(type=regex)|'index_temp_5' "<li.*?<\/li>"}
index_showsplit.modify {remove(type=regex)|"^<li style=\"width: \d*px;\"><\/li>$"} * blank gaps in epg
*index_showsplit.modify {(debug)}
end_scope
*
index_start.scrub {single|<span>|| -|<}
index_stop.scrub  {single|<span>| -|<|<}
index_title.scrub {single|<h3>||</h3>|</h3>}
index_description.scrub {single|<p>||</p>|</p>}
**  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _
**      #####  CHANNEL FILE CREATION (only to create the xxx-channel.xml file)
**
** @auto_xml_channel_start
*url_index {url|https://www.vivacom.bg/bg/tv/programa/?date=|urldate|&page=|subpage|}
*subpage.format {list(format=D0 step=1 count=30)|1}
*index_site_id.scrub {multi|<ol id="scroll-vertical">|title="|"|</ol>}
*index_site_channel.modify  {set|'index_site_id'}
*index_site_id.modify {cleanup(removeduplicates=equal,100 link="index_site_channel")}
*end_scope
** @auto_xml_channel_end
